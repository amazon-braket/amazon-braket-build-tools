[tox]
envlist = linters,unit-tests

[testenv:unit-tests]
usedevelop=true
basepython = python3
# {posargs} contains additional arguments specified when invoking tox. e.g. tox -- -s -k test_foo.py
deps =
    {[test-deps]deps}
commands =
    coverage run -m pytest {posargs}
    coverage report
    coverage html
    coverage xml
extras = test

[testenv:integ-tests]
basepython = python3
# {posargs} contains additional arguments specified when invoking tox. e.g. tox -- -s -k test_foo.py
deps =
    {[test-deps]deps}
commands =
    pytest test/integ_tests {posargs}
extras = test

[testenv:linters]
basepython = python3
skip_install = true
deps =
    {[testenv:isort]deps}
    {[testenv:black]deps}
    {[testenv:pylint]deps}
    {[testenv:flake8]deps}
commands =
# isort MUST come before black as it will revert any changes made by black
    {[testenv:isort]commands}
    {[testenv:black]commands}
    {[testenv:flake8]commands}
    {[testenv:pylint]commands}

[testenv:flake8]
basepython = python3
skip_install = true
deps =
    flake8
commands =
    flake8 src {posargs}

[testenv:pylint]
basepython = python3
skip_install = true
deps =
    pylint
commands =
    pylint src {posargs}

[testenv:isort]
basepython = python3
skip_install = true
deps =
    isort
commands =
    isort . {posargs}

[testenv:black]
basepython = python3
skip_install = true
deps =
    black
commands =
    black src {posargs}

[testenv:zip-build]
basepython = python3
skip_install = true
commands =
    /bin/sh -c 'tar -czvf build_files.tar.gz build/'

[test-deps]
deps =
    # If you need to test on a certain branch, add @<branch-name> after .git
    git+https://github.com/aws/amazon-braket-sdk-python.git@main
